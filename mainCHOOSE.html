


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translation Game</title>
    <style>
            @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css');

body {
    width: 100%;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: black;
          overflow: hidden;

}

.question-container {
    width: 100%;
    display: flex;
  flex-direction: column;
  align-items: left;
    justify-content: left; /* Center the question */
    margin-bottom: 2vh;
    padding: 0.5vh 1vh;
 background-color:#0b150b;    color: lime;
    font-weight: bold;
  font-size: clamp(6px, 4vw, 4rem);
    border: 0.5vh solid lime;
        text-transform: uppercase;

}

#button-container {
  display: flex;    height: 55vh;

  flex-direction: column;
  align-items: center;
}

.column {
    
    justify-content: space-around;
    width: 100%; /* Adjust width as needed, e.g., 20% of viewport width */
    min-width: 15vw; /* Ensure columns don’t get too narrow */
    margin: 0.1vh 0.1vh; /* Margin between columns */
    height: 100%; /* Ensure column takes full height */

    box-sizing: border-box; /* Include padding and border in width calculation */
}

.column:active{
    opacity: 1; /* Highlight active column */
    transform: scale(1); 
        border: 0.2vh solid yellow;

}

.translation-button {
  font-size: clamp(3px, 3.2vw, 3.4rem);
    color: #FFFFFF;
  padding:0;
    font-weight: bold;
    background-color: black;
    cursor: pointer;
    width: 100%; /* Make buttons fill the column width */
    border: 0.1vh solid white;
    text-transform: uppercase;
    flex: 1; /* Make buttons flexible */
  
}
.translation-button:hover {
    background-color: black;
    color: yellow;
border:0.5vh solid yellow;

}
.column:not(.active) {
    pointer-events: none;
    opacity: 0.3; /* Optional: visually indicate inactive columns */
}
.translation-button.correct {
    background-color: black; /* Green background */
    color: lime;
    border: 0.5vh solid lime;
}

.translation-button.incorrect {
    background-color: black; /* Red background */
    color: red; /* White text */
    border: 0.5vh solid red;
}
.translation-button:selected {
    background-color: black;
    color: cyan;
    font-size: 2vh;
      padding: 0;

}
   .title-button1 {
       position:absolute;
       top:0%;left:0%;
background-color: black; /* Red background */
color: white; /* White text */
border: 0.5vh solid white;
  width:12vh;
  height:12vh;
   border-radius: 50%;}
.title-button1:hover {
background-color: darkgrey; /* Red background */
color: red; /* White text */
border: 0.5vh solid red;
  width:12vh;
  height:12vh;
   border-radius: 50%;} 
         .save-score {
  background-color:#0b150b;
position:absolute; top:90%; right:1%;
color: lime;
  padding: 1vh 1vh;
  font-size: 16px;
            border: 0.5vh solid lime;

  font-weight: bold;
  border-radius: 1vh;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
}
  #score-display   {
  background-color: transparent;
position:absolute; bottom:3%; right:30%;
color: white;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
} 
.save-score:hover {
  background-color: #45A049;
  transform: scale(1.05);
}

.save-score:active {
  background-color: yellow;
  color:black;
  transform: scale(0.98);
}

@keyframes focusOutline {
  0% {
    outline-offset: 0;
    outline-color: transparent;
  }
  25% {
    outline-offset: 1vh;
    outline-color: #4CAF50;
  }
  50% {
    outline-offset: 2vh;
    outline-color: #4CAF50;
  }
  75% {
    outline-offset: 1vh;
    outline-color: #4CAF50;
  }
  100% {
    outline-offset: 0vh;
    outline-color: #4CAF50;
  }
}

.save-score:focus {
  outline: 0.5vh solid #4CAF50;
  outline-offset: 2vh;
  animation: focusOutline 2s ease-in-out forwards;
}
 #voiceSelect{position:absolute;
        bottom:2%;
        left:0%;
        font-size:2.7vh;
        width:50%;
        background-color:#02051E;
        color:cyan;
        border:0.3vh solid cyan;
}   
    button[onclick="navigateTomainRECOGNIZER()"] {
   background-color:transparent;
         color:pink;
         font-weight:bold;
     font-size: 2vh;
 border:none;
position:absolute;
         top:87%;
         left:1%;
         width:20%;
         width:60%;
         height:10%;
}
      .microphone-icon {
    color: red;
    font-size: 8vh;
    border-radius: 50%;
    background-color: transparent;
    border: 0.7vh solid #ff0000;
    justify-content: space-between;
    padding: 5% 25%;
    transition: all 1s ease;
       
}

.microphone-icon:hover {
    background-color: transparent;
    text-shadow: 0 0 0.5vh #F03200, 0 0 0.5vh #F00032, 0 0 0.7vh darkred;
    box-shadow: 0 0 1vh #F03200, 0 0 3vh #F00032, 0 0 5vh red;
}
     .containerpr {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-top: 2vh; /* Adjust margin as needed */
          
        }
     .pronoun-container {
    display: flex;
    gap: 0.2vh;
    justify-content: center;
    margin-bottom: 10px;
              width: 99%;

      }

.pronoun-button {
    cursor: pointer;
    border-radius: 5px;
    border: 1px solid #ddd;
    background-color: #f1f1f1;
    font-size: 1.5vh;
    text-transform: uppercase;
    font-weight: bold;
              width: 100%;
HEIGHT:4VH;
}

.pronoun-button.selected {
    background-color: #0c1c0c;
    color: lime;
    border: 0.25vh solid lime;
}
 .title-button0a {
 
       transition: all 1s ease;
 background-color:black; color:white;  font-size: 1.7vh;   border: 0.3VH solid cyan;border-radius: 50%;height:13vh;width:13vh;text-align:center;align-items: center;weight:bold; 
}

.title-button0a:hover {
      font-weight: bold;
  background-color: #000018;
   text-shadow: 0 0 0.5vh lightblue, 0 0 0.5vh purple, 0 0 0.7vh darkblue;
    box-shadow: 0 0 1vh lightblue, 0 0 3vh purple, 0 0 5vh darkblue;
  box-sizing: border-box;
  color:lightblue;
}
  </style>
  </head>
  <body> 
  <div class="containerpr">
  <div class="pronoun-container">
            <button class="pronoun-button selected" data-pronoun="yo">yo</button>
            <button class="pronoun-button" data-pronoun="tu">tú</button>
            <button class="pronoun-button" data-pronoun="el">él</button>
            <button class="pronoun-button" data-pronoun="nosotros">nosotros</button>
            <button class="pronoun-button" data-pronoun="vosotros">vosotros</button>
            <button class="pronoun-button" data-pronoun="ellos">ellos</button>
    </div>
        </div>

    <div id="question-container" class="question-container"></div>
    <div class="button-container" id="button-container"></div>
        <button
          class="title-button0a" onclick="navigateTomainCHOOSE2()"
   style="position:absolute; bottom:1%;right:1%;font-size:1.6vh;font-weight:bold;height:10vh;width:14vh; border:0.3vh solid #ffcafc; color: #ffcafc;;border-radius: 50%;background-color:black;text-align:center;align-items: center; transition: all 1s ease;">PLAY QUICK</button>
      
       <select id="voiceSelect">
    <option value="">Select a Spanish voice</option>
</select>
        
    <script>
  const pronouns = [
            'yo',
            'tu',
            'el',
            'nosotros',
            'vosotros',
            'ellos'
        ];


  const params = new URLSearchParams(window.location.search);
  const questionsJSON = params.get('questions');
  const questions = new Map(JSON.parse(questionsJSON));

let selectedPronoun = 'yo'; // Default pronoun
let correctAnswersPerPronoun = {
    'yo': 0,
    'tu': 0,
    'el': 0,
    'nosotros': 0,
    'vosotros': 0,
    'ellos': 0
};

// Track answered questions and translations **per pronoun**
let hiddenQuestions = new Map();
let hiddenTranslationsPerPronoun = new Map();

// List of pronouns in order
let pronounsList = ['yo', 'tu', 'el', 'nosotros', 'vosotros', 'ellos'];

// Initialize hiddenQuestions and hiddenTranslationsPerPronoun for each pronoun
pronounsList.forEach(pronoun => {
    hiddenQuestions.set(pronoun, new Set());
    hiddenTranslationsPerPronoun.set(pronoun, new Set());
});

function getNextAvailablePronoun() {
    for (let pronoun of pronounsList) {
        let button = document.querySelector(`.pronoun-button[data-pronoun="${pronoun}"]`);
        if (button && button.style.display !== 'none') {
            return pronoun;
        }
    }
    return null; // No pronouns left
}

// Event listeners for selecting pronouns manually
document.querySelectorAll('.pronoun-button').forEach(button => {
    button.addEventListener('click', function () {
        document.querySelectorAll('.pronoun-button').forEach(btn => btn.classList.remove('selected'));
        this.classList.add('selected');
        
        selectedPronoun = this.getAttribute('data-pronoun');
        loadQuestion();
    });
});

function loadQuestion() {
    const questionSet = questions.get(selectedPronoun);
    if (!questionSet) return;

    // Remove answered questions
    const unansweredQuestions = questionSet.filter(q => !hiddenQuestions.get(selectedPronoun).has(q.question));

    // If this pronoun is done, remove it and move to the next available
    if (unansweredQuestions.length === 0) {
        document.querySelector(`.pronoun-button[data-pronoun="${selectedPronoun}"]`).style.display = 'none';

        let nextPronoun = getNextAvailablePronoun();
        if (nextPronoun) {
            selectedPronoun = nextPronoun;
            document.querySelector(`.pronoun-button[data-pronoun="${selectedPronoun}"]`).classList.add('selected');
            setTimeout(loadQuestion, 500); // Smooth transition
        } else {
            alert("All pronouns completed! Restarting...");
            setTimeout(resetGame, 1000);
        }
        return;
    }

    // Pick a random unanswered question
    const randomIndex = Math.floor(Math.random() * unansweredQuestions.length);
    const { question, translation } = unansweredQuestions[randomIndex];

    hiddenQuestions.get(selectedPronoun).add(question); // Mark as answered

    document.getElementById('question-container').innerText = question;
    
    const buttonContainer = document.getElementById('button-container');
    buttonContainer.innerHTML = ''; // Clear buttons

    // Shuffle and display translation options
    const shuffledTranslations = shuffleArray(questionSet.map(q => q.translation));
    
    shuffledTranslations.forEach(trans => {
        if (hiddenTranslationsPerPronoun.get(selectedPronoun).has(trans)) return; // **Only check for this pronoun!**

        const button = document.createElement('button');
        button.innerText = trans;
        button.classList.add('translation-button');
        
        button.onclick = function () {
            totalPlayed++;

            if (trans === translation) {
                correctAnswerCount++;
                button.classList.add('correct');
                button.style.display = 'none';

                // **Only hide translation for the current pronoun!**
                hiddenTranslationsPerPronoun.get(selectedPronoun).add(trans);

                speakText(trans);

                correctAnswersPerPronoun[selectedPronoun]++;

                if (correctAnswersPerPronoun[selectedPronoun] === questionSet.length) {
                    document.querySelector(`.pronoun-button[data-pronoun="${selectedPronoun}"]`).style.display = 'none';
                    setTimeout(loadQuestion, 500);
                } else {
                    setTimeout(loadQuestion, 2000);
                }

            } else {
                button.classList.add('incorrect');
                setTimeout(() => button.classList.remove('incorrect'), 1000);
            }

            updateScoreDisplay();
        };

        buttonContainer.appendChild(button);
    });
}

function resetGame() {
    pronounsList.forEach(pronoun => {
        document.querySelector(`.pronoun-button[data-pronoun="${pronoun}"]`).style.display = 'block';
        correctAnswersPerPronoun[pronoun] = 0;
        hiddenQuestions.set(pronoun, new Set());
        hiddenTranslationsPerPronoun.set(pronoun, new Set());
    });

    selectedPronoun = 'yo'; // Reset to default pronoun
    document.querySelector(`.pronoun-button[data-pronoun="${selectedPronoun}"]`).classList.add('selected');

    loadQuestion();
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

loadQuestion();

let totalPlayed = 0;        
let correctAnswerCount = 0;

function updateScoreDisplay() {
    let accuracy = totalPlayed > 0 ? (correctAnswerCount / totalPlayed) * 100 : 0;
    document.getElementById("score-display").innerText = `${Math.round(accuracy)}%`;
}

function saveScore(activityKey) {
    const scoreElement = document.getElementById("score-display");
    const scoreText = scoreElement.textContent.trim();

    // Extract numeric percentage (e.g., "75%") → "75"
    const score = scoreText.replace("%", "").trim();

    localStorage.setItem(activityKey, score);
}

let selectedVoice = null;

function speakText(text) {
    if (!text || !selectedVoice) return; // Prevent empty speech

    // Cancel any ongoing speech to avoid overlap
    window.speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.voice = selectedVoice;
    window.speechSynthesis.speak(utterance);
}


function populateVoiceList() {
  const voiceSelect = document.getElementById("voiceSelect");
  const voices = speechSynthesis.getVoices();

  voiceSelect.innerHTML = '';  // Clear existing options

  const defaultOption = document.createElement("option");
  defaultOption.value = '';
  defaultOption.innerText = 'Select a Spanish voice';
  voiceSelect.appendChild(defaultOption);

  const spanishVoices = voices.filter(voice => voice.lang.startsWith('es'));

  if (spanishVoices.length === 0) {
    const noVoicesOption = document.createElement("option");
    noVoicesOption.value = '';
    noVoicesOption.innerText = 'No Spanish voices available';
    voiceSelect.appendChild(noVoicesOption);
  }

  spanishVoices.forEach(voice => {
    const option = document.createElement("option");
    option.value = voice.name;
    // Remove the word "Microsoft" from the display name
    option.innerText = `${voice.name.replace(/Microsoft|Spanish|Google/gi, '').trim()} (${voice.lang})`;
    voiceSelect.appendChild(option);
  });

  // Set the default voice to es-ES
  const esVoice = spanishVoices.find(voice => voice.lang === 'es-ES');
  selectedVoice = esVoice || spanishVoices[0] || voices[0];
  voiceSelect.value = selectedVoice.name;
}

// Check if voices are loaded and populate the dropdown
function checkVoices() {
  const voices = speechSynthesis.getVoices();
  if (voices.length !== 0) {
    populateVoiceList();
  } else {
    speechSynthesis.onvoiceschanged = populateVoiceList;
  }
}

// Change the selected voice when a new one is chosen from the dropdown
document.getElementById("voiceSelect").addEventListener("change", function() {
  selectedVoice = speechSynthesis.getVoices().find(voice => voice.name === this.value);
});

// Initialize
checkVoices();
loadQuestion(getRandomQuestionIndex());

      function navigateTomainCHOOSE2() {
const questionsObject = {};
questions.forEach((value, key) => {
    questionsObject[key] = value;
});

localStorage.setItem("questionsData", JSON.stringify(questionsObject));

window.location.href = "mainCHOOSE2.html";
   }
       

</script>
</body>
</html>